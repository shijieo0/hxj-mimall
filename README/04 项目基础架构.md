# 项目基础架构

## 4.1 跨域——CORS

@CrossOrigin

## 4.2 跨域——JSONP



## 4.3 跨域——接口代理

## 4.4 接口梳理

## 4.5 目录结构设置



## 4.6 基本插件

需要安装的插件：

npm i vue-lazyload  element-ui  node-sass sass-loader vue-awesome-swiper vue-axios vue-cookie  --save-dev

插件一句话简介

* vue-lazyload  懒加载
* element-ui  
* node-sass    sass预编译器
* sass-loader
* vue-awesome-swiper    轮播组件
* vue-axios   方便把axios挂载到vue里面去
* vue-cookie   前后端交互信息
* --save-dev

npm install --save jsonp



## 4.7 路由封装



## 4.8 Storage封装

1、Cookie、localStorage、sessionStorage 三者区别？

* 存储大小：Cookie 4K、Storage 5M
* 有效期：Cookie 拥有有效期、Storage 永久存储
* Cookie 会发送到服务器端，存储在内存中，Storage只存储在浏览器端
* 路径：Cookie有路径限制，Storage只存储在域名下
* API：Cookie没有特定的API，Storage有对应的API

2、为什么要封装Storage，本身不是已经有API?

F12->Application->Session Storage->key[mall], value[{"user":{"userName":"jack","age":30,"sex":1}}]

F12->Console

JSON.parse(window.sessionStorage.getItem('mall') || '{}')



## 4.9 接口错误拦截

* 统一报错（底层报错、业务报错）

* 未登录统一拦截

* 请求值、返回值统一处理
* 拦截实现方式文档：https://www.npmjs.com/package/axios   Interceptors

拦截举例：在main.js中导入axios，对响应统一拦截

> import axios from 'axios'
>
> import VueAxios from 'vue-axios'
>
> 
>
> // 根据前端的跨域方式做调整 /a/b : /api/a/b => /a/b
>
> // 暂定为接口代理的方式
>
> axios.defaults.baseURL = '/api';
>
> axios.defaults.timeout = 8000;
>
> // 响应接口错误拦截
>
> axios.interceptors.response.use(function (response) {
>
>   let res = response.data;
>
>   if(res.status == 0) { // 成功
>
> ​    return res.data;
>
>   } else if(res.status == 10) { // 自定义状态码，未登录
>
> ​    window.location.href = '/#/login';
>
>   } else {
>
> ​    alert(res.msg);
>
>   }
>
> }, function (error) {
>
>   // Any status codes that falls outside the range of 2xx cause this function to trigger
>
>   // Do something with response error
>
>   return Promise.reject(error);
>
> });
>
> 
>
> Vue.use(VueAxios, axios)
>
> // 开发模式设置为true，可以看到更多底层的告警信息
>
> Vue.config.productionTip = true



## 4.10 接口环境设置

* 开发上线的不同阶段，需要不同的配置
* 不同的跨域方式，配置不同
* 打包的时候统一注入环境参数，统一管理环境，输出不同的版本包

在项目根目录创建 vue.config.js，使用代理的方式进行接口拦截，这种方式简单、安全，隐藏了后端真实接口地址

> module.exports = {
>
> ​    devServer: {
>
> ​        host:'localhost',
>
> ​        port: 8080,
>
> ​        proxy: {
>
> ​            '/api': {
>
> ​                target:'https://www.imooc.com',
>
> ​                changeOrigin:true,
>
> ​                pathRewrite:{
>
> ​                    '/api':''
>
> ​                }
>
> ​            }
>
> ​        }
>
> ​    }
>
> }

env.js

> let baseURL;
>
> switch(process.env.NODE_ENV) {
>
> ​    case 'development':
>
> ​        baseURL='http://dev-mall-pre.springboot.cn/api';
>
> ​        break;
>
> ​    case 'test':
>
> ​        baseURL='http://test-mall-pre.springboot.cn/api';
>
> ​        break;
>
> ​    case 'production':
>
> ​        baseURL='http://mall-pre.springboot.cn/api';
>
> ​        break;
>
> ​    default:
>
> ​        baseURL='http://mall-pre.springboot.cn/api';
>
> ​        break;
>
> }
>
> export default {
>
> ​    baseURL
>
> }

* 代理的方式切换环境：同时修改main.js和vue.config.js



## 4.11 Mock设置

> Mock的好处

* 开发阶段，为了提高效率，需要提前Mock
* 减少代码冗余，灵活插拔
* 减少沟通，减少接口联调时间

> 实现Mock的方法

* 本地创建json
* easy-mock平台
* 本地集成Mock API

> mockjs安装

cnpm i mockjs  --save-dev

> mockjs集成



> mockjs语法 <https://github.com/nuysoft/Mock/wiki/Getting-Started>


